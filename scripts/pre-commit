#!/bin/sh

echo "[Hook] Git pre-commit hook started..."

# Git 루트 디렉토리 이동
PROJECT_ROOT=$(git rev-parse --show-toplevel)
echo "📂 [Info] Project root: $PROJECT_ROOT"

# 현재 스테이지된 파일 목록 추출
stagedFiles=$(git diff --cached --name-only)
echo "[Info] Staged files:"
echo "$stagedFiles"

# spotlessApply 실행
echo "[Action] Running spotlessApply..."
cd "$PROJECT_ROOT" || exit 1
./gradlew spotlessApply

if [ $? -ne 0 ]; then
    echo "❌ [Error] spotlessApply failed!"
    exit 1
else
    echo "✅ [Success] spotlessApply completed successfully."
fi

# 변경된 파일 다시 스테이징
echo "[Action] Re-adding modified files to staging..."
for file in $stagedFiles; do
  if test -f "$file"; then
    echo "➕ Adding: $file"
    git add "$file"
  fi
done

echo "✅ [Hook] Pre-commit hook finished successfully."
